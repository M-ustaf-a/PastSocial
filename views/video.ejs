<%layout('/layouts/boilerplate.ejs')%>

<style>
    :root {
        --primary-color: #A82400;
        --background-color: #FDF2E4;
        --card-background: #FEE4BD;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --border-radius-lg: 25px;
        --border-radius-sm: 12px;
        --spacing-sm: 10px;
        --spacing-md: 15px;
        --max-width: 1200px;
        --text-color: #502000;
        --secondary-color: #CD7D4C;
        --card-hover: #FFCEA9;
    }

    body {
        background-color: var(--background-color);
        background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23a82400' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: var(--text-color);
    }

    .container {
        max-width: var(--max-width);
        margin: 0 auto;
        padding: 0 15px;
    }

    .header {
        position: sticky;
        top: 0;
        background-color: var(--background-color);
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(168, 36, 0, 0.1);
        padding: 8px 0;
        backdrop-filter: blur(5px);
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md);
        max-width: var(--max-width);
        margin: 0 auto;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
        color: white;
        border: none;
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--border-radius-lg);
        text-decoration: none;
        box-shadow: 0 4px 6px rgba(168, 36, 0, 0.2);
        transition: all 0.3s;
    }

    .brand:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(168, 36, 0, 0.25);
    }

    .brand-title {
        font-size: 1.25rem;
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    .create-post-btn {
        background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
        color: white;
        border: none;
        border-radius: var(--border-radius-lg);
        padding: var(--spacing-sm) var(--spacing-md);
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(168, 36, 0, 0.2);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .create-post-btn span {
        display: none;
    }

    .create-post-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(168, 36, 0, 0.25);
    }

    .create-post-btn:hover span {
        display: inline;
    }

    .page-title {
        text-align: center;
        margin: 20px 0;
        color: var(--primary-color);
        font-size: 1.8rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(168, 36, 0, 0.1);
    }

    .posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
        max-width: var(--max-width);
        margin: 30px auto;
        padding: var(--spacing-md);
    }

    .post-card {
        background: linear-gradient(145deg, var(--card-background), #FFF1E0);
        border-radius: var(--border-radius-sm);
        overflow: hidden;
        box-shadow: 0 10px 15px var(--shadow-color);
        transition: all 0.3s;
        position: relative;
        border: 1px solid rgba(168, 36, 0, 0.1);
    }

    .post-card:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 15px 30px rgba(168, 36, 0, 0.15);
        background: linear-gradient(145deg, var(--card-hover), #FFF6EA);
    }

    .post-title {
        font-style: italic;
        font-family: 'Georgia', serif;
        padding: var(--spacing-md);
        text-align: center;
        background-color: transparent;
        border: none;
        width: 100%;
        font-weight: bold;
        font-size: 1.1rem;
        color: var(--primary-color);
        cursor: pointer;
        transition: color 0.2s;
    }

    .post-title:hover {
        color: var(--secondary-color);
    }

    .post-video {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-top: 2px solid rgba(168, 36, 0, 0.1);
        border-bottom: 2px solid rgba(168, 36, 0, 0.1);
        transition: height 0.3s;
    }

    .post-card:hover .post-video {
        height: 220px;
    }

    .post-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-sm) var(--spacing-md);
        background-color: rgba(255, 255, 255, 0.5);
    }

    .interaction-section {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .heart-icon {
        cursor: pointer;
        height: 30px;
        width: 30px;
        transition: all 0.3s;
        filter: drop-shadow(0 2px 3px rgba(168, 36, 0, 0.2));
    }

    .heart-icon:hover {
        transform: scale(1.2);
        filter: drop-shadow(0 3px 5px rgba(168, 36, 0, 0.3));
    }

    .heart-count {
        font-weight: bold;
        color: var(--primary-color);
    }

    .user-section {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .user-info {
        display: flex;
        flex-direction: column;
        font-size: 0.8rem;
    }

    .user-name {
        font-weight: bold;
        color: var(--primary-color);
    }

    .post-date {
        color: #777;
        font-size: 0.75rem;
    }

    .user-avatar {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        border: 2px solid var(--primary-color);
        transition: all 0.3s;
        object-fit: cover;
        box-shadow: 0 3px 5px rgba(168, 36, 0, 0.2);
    }

    .user-avatar:hover {
        transform: scale(1.1);
        box-shadow: 0 5px 10px rgba(168, 36, 0, 0.3);
        border-color: var(--secondary-color);
    }

    .post-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--primary-color);
        color: white;
        font-size: 0.7rem;
        padding: 3px 8px;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .trending-badge {
        background: linear-gradient(to right, #ff7e00, #ff0000);
    }

    .new-badge {
        background: linear-gradient(to right, #00c853, #009624);
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 30px 0;
    }

    .pagination-btn {
        background-color: var(--card-background);
        border: none;
        color: var(--primary-color);
        padding: 8px 15px;
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        transition: all 0.2s;
        font-weight: bold;
    }

    .pagination-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }

    .pagination-btn.active {
        background-color: var(--primary-color);
        color: white;
    }

    @media (max-width: 768px) {
        .posts-grid {
            grid-template-columns: 1fr;
            padding: var(--spacing-sm);
            gap: 20px;
        }

        .post-card {
            max-width: 500px;
            margin: 0 auto;
        }

        .create-post-btn span {
            display: none;
        }

        .user-info {
            display: none;
        }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
        .posts-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1025px) {
        .create-post-btn span {
            display: inline;
        }
    }
</style>

<div class="header">
    <div class="header-content">
        <a href="#" class="brand">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.5 10a.5.5 0 0 0 .832.374l4.5-4a.5.5 0 0 0 0-.748l-4.5-4A.5.5 0 0 0 5.5 4z"/>
            </svg>
            <span class="brand-title">JustPost</span>
        </a>
        <form action="/community/<%= community._id %>/posts/new" method="get">
            <button class="create-post-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01z"/>
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                </svg>
                <span>New Post</span>
            </button>
        </form>
    </div>
</div>

<div class="container">
    <h1 class="page-title"><%= community.name %> Community</h1>

    <div class="posts-grid">
        <% for(let i = 0; i < videos.length; i++) { 
           const video = videos[i];
           const isTrending = i < 2; // First two videos are trending
           const isNew = i % 3 === 0; // Every third video is new
        %>
            <div class="post-card">
                <% if (isTrending) { %>
                    <div class="post-badge trending-badge">Trending</div>
                <% } else if (isNew) { %>
                    <div class="post-badge new-badge">New</div>
                <% } %>
                
                <button type="button" 
                        class="post-title" 
                        data-bs-container="body" 
                        data-bs-toggle="popover" 
                        data-bs-placement="top" 
                        data-bs-content="<%=video.description || 'No description available'%>">
                    <%=video.title%>
                </button>
                
                <% if (video.video && video.video.url) { %>
                    <video class="post-video" controls>
                        <source src="<%= video.video.url %>" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                <% } %>
                
                <div class="post-actions">
                    <div class="interaction-section">
                        <img src="/heart.svg" 
                             alt="Heart Icon" 
                             class="heart-icon" 
                             data-post-id="<%= video.id %>" 
                             onclick="toggleHeart(this)">
                        <span class="heart-count"><%= Math.floor(Math.random() * 50) + 1 %></span>
                    </div>
                    
                    <div class="user-section">
                        <div class="user-info">
                            <span class="user-name"><%=currUser.username || 'User'%></span>
                            <span class="post-date"><%= new Date().toLocaleDateString() %></span>
                        </div>
                        <a href="/community/<%= community.id %>/<%= currUser.id %>/showProfile" 
                           class="admin-badge" 
                           data-bs-toggle="tooltip" 
                           data-bs-placement="top" 
                           title="<%=currUser.username || 'User'%> • Community Admin">
                            <img src="<%=currUser.image.url || 'default-avatar.jpg'%>" 
                                 alt="user" 
                                 class="user-avatar" />
                        </a>
                    </div>
                </div>
            </div>
        <% } %>
    </div>

    <div class="pagination">
        <button class="pagination-btn active">1</button>
        <button class="pagination-btn">2</button>
        <button class="pagination-btn">3</button>
        <button class="pagination-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
            </svg>
        </button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Initialize Bootstrap components
    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
    const popoverList = [...popoverTriggerList].map(popoverTriggerEl => 
        new bootstrap.Popover(popoverTriggerEl)
    );

    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => 
        new bootstrap.Tooltip(tooltipTriggerEl)
    );
    
    // Pagination buttons
    const paginationBtns = document.querySelectorAll('.pagination-btn');
    paginationBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            paginationBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        });
    });
});

function toggleHeart(element) {
    if (!element) return;
    
    const currentSrc = element.getAttribute('src');
    const postId = element.getAttribute('data-post-id');
    const newSrc = currentSrc === '/heart.svg' ? '/heart-fill.svg' : '/heart.svg';
    
    element.setAttribute('src', newSrc);
    element.style.transform = 'scale(1.3)';
    
    // Update heart count
    const heartCount = element.nextElementSibling;
    if (heartCount) {
        let count = parseInt(heartCount.textContent);
        if (newSrc === '/heart-fill.svg') {
            count += 1;
        } else {
            count = Math.max(0, count - 1);
        }
        heartCount.textContent = count;
    }
    
    // Reset transform after animation
    setTimeout(() => {
        element.style.transform = 'scale(1)';
    }, 300);
    
    // Log action
    console.log(`${newSrc === '/heart-fill.svg' ? 'Liked' : 'Unliked'} post ${postId}`);
}
</script>