<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../public/css/popoverStyle.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <title>Document</title>
    <style>
      body {
        background-color: blanchedalmond;
      }
      .container {
        position: relative;
      }

      #popoverButton svg {
        cursor: pointer;
      }

      a {
        text-decoration: none;
      }

      a svg {
        color: #a82400;
      }

      .popover {
        background-color: #fee4bd;
        width: 690px;
        position: absolute;
        top: 50px;
        left: 30%;
        transform: translateX(-50%);
        border: 1px solid #f9d8a6;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        padding: 15px;
        display: none;
        z-index: 100;
      }

      .popover a {
        text-decoration: none;
      }
      .popover::before {
        content: "";
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        border-width: 10px;
        border-style: solid;
        border-color: transparent transparent white transparent;
      }
      .button {
        padding: 10px;
        border: none;
        border-radius: 6px;
        background-color: blanchedalmond;
        margin-top: 10px;
      }
      .button:hover {
        background-color: #f9d8a6;
      }

      .header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background-color: transparent;
        width: 100%;
      }
      .filled {
        fill: red;
      }
      .rows {
        background-color: aliceblue;
        width: 23rem;
        align-items: center;
        height: auto;
        display: flex;
        flex-direction: column;
      }

      .profile-menu-user {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px;
        min-width: 40px;
        height: 40px;
    }
    
    .profile-menu-user .dropdown {
        position: relative;
        display: inline-block;
    }
    
    .profile-menu-user .dropdown-toggle {
        padding: 0;
        border: none;
        background: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .profile-menu-user img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
    }
    
    .profile-menu-user img:hover {
        transform: scale(1.05);
    }
    
    .dropdown-menu {
        background-color: #fee4bd;
        border: 1px solid #f9d8a6;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        min-width: 200px;
        padding: 8px 0;
    }
    
    .dropdown-item {
        color: #a82400;
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.2s ease;
    }
    
    .dropdown-item:hover {
        background-color: #f9d8a6;
    }
    
    .dropdown-item svg {
        width: 16px;
        height: 16px;
    }
    @media screen and (max-width: 768px) {
      .profile-menu-user {
          margin: 8px;
          min-width: 35px;
          height: 35px;
      }
  
      .profile-menu-user img {
          width: 35px;
          height: 35px;
      }
  
      .dropdown-menu {
          position: fixed;
          right: 10px;
          left: auto;
          min-width: 180px;
      }
  
      .dropdown-item {
          padding: 10px 16px;
      }
  }
  
  @media screen and (max-width: 480px) {
      .profile-menu-user {
          margin: 6px;
          min-width: 32px;
          height: 32px;
      }
  
      .profile-menu-user img {
          width: 32px;
          height: 32px;
      }
  
      .dropdown-menu {
          min-width: 160px;
          right: 5px;
      }
  
      .dropdown-item {
          font-size: 14px;
          padding: 8px 12px;
      }
  }
    </style>
  </head>
  <body>
    <div class="container" style="padding: 0px">
      <header class="header">
        <div
          class="d-flex justify-content-between align-items-center flex-wrap"
        >
          <a href="/community">
            <h1 style="color: #a82400; margin: 20px">
              <img src="/group.png" alt="group-icon" height="35" width="35" />
            </h1>
          </a>
          <span class="create-comm">
            <div class="container">
              <%if(user){%>
              <div class="profile-menu-user" style="display: block">
                <div class="dropdown">
                  <button
                    class="dropdown-toggle"
                    type="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <img
                      src="<%=user.image.url%>"
                      alt="Profile Picture"
                      style="margin-top: 7.5%"
                    />
                  </button>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/community/adminProfile">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="16"
                          height="16"
                          fill="currentColor"
                          class="bi bi-person-fill"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"
                          /></svg> Profile
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/createCommunity">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
                          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3z"/>
                        </svg> Create
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/admin/logout">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-door-open-fill" viewBox="0 0 16 16">
                          <path d="M1.5 15a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1H13V2.5A1.5 1.5 0 0 0 11.5 1H11V.5a.5.5 0 0 0-.57-.495l-7 1A.5.5 0 0 0 3 1.5V15zM11 2h.5a.5.5 0 0 1 .5.5V15h-1zm-2.5 8c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1"/>
                        </svg> logout
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
              <%}else{%>
                <div class="dropdown">
                  <button class="dropdown-toggle bg-transparent" style="border: none;" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="currentColor"
                    class="bi bi-three-dots-vertical"
                    viewBox="0 0 16 16"
                    >
                      <path
                       d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"
                      />
                  </svg>
                  </button>
                
                  <ul class="dropdown-menu p-3">
                    <b>Are you already a member of justPost?</b>
                    <div style="display: flex; gap: 25px">
                      <form action="/createCommunity" method="get">
                       <button class="button">Yes</button>
                      </form>
                      <form action="/admin/approval" method="get">
                        <button class="button">No</button>
                      </form>
                    </div> 
                  </ul>
                </div>
              <!-- <div id="popoverButton" class="popover-button">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="currentColor"
                  class="bi bi-three-dots-vertical"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"
                  />
                </svg>
              </div>
              <div id="popover" class="popover">
                <b>Are you already a member of justPost?</b>
                <div style="display: flex; gap: 25px">
                  <form action="/createCommunity" method="get">
                    <button class="button">Yes</button>
                  </form>
                  <form action="/admin/approval" method="get">
                    <button class="button">No</button>
                  </form>
                </div> -->
              <%}%>
            </div>
          </span>
        </div>
      </header>
      <div class="row g-1">
        <% for(community of Communities){ %>
        <div
          class="community col-20 col-md-6 col-lg-4 d-flex justify-content-center mb-3"
          style="padding: 0; margin: 0px"
        >
          <div
            class="rows"
            style="
              border-radius: 23px;
              background-color: #feebca;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
              border: 1px solid #fbe1b5;
            "
          >
            <button
              type="button"
              class="btn btn-light mt-1 mb-1"
              data-bs-container="body"
              data-bs-toggle="popover"
              data-bs-placement="top"
              data-bs-content="<%=community.admin%>"
              style="
                font-style: oblique;
                background-color: #feebca;
                border: none;
              "
            >
              <b><%=community.title%></b>
            </button>
            <a href="/community/<%= community._id %>/main">
              <div>
                <img
                  src="<%=community.thumbnail.url%>"
                  alt="thumbnail"
                  style="border-radius: 23px; height: 170px; width: 300px"
                />
              </div>
            </a>
            <a
              href="/community/<%= community._id %>/main"
              style="text-decoration: none; color: black; margin-top: 10px"
            >
              <div style="margin-left: 9%">
                <b>Description</b>
                <p
                  style="
                    overflow-y: scroll;
                    overflow-x: hidden;
                    scrollbar-width: none;
                    height: 60px;
                    width: 90%;
                  "
                >
                  <%= community.description %>
                </p>
              </div>
            </a>
          </div>
        </div>
        <%}%>
        <div><%-include("./includes/footer.ejs")%></div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
    <script>
      const popoverTriggerList = document.querySelectorAll(
        '[data-bs-toggle="popover"]'
      );
      const popoverList = [...popoverTriggerList].map(
        (popoverTriggerEl) => new bootstrap.Popover(popoverTriggerEl)
      );

      // Popover functionality
      const button = document.getElementById("popoverButton");
      const popover = document.getElementById("popover");

      button.addEventListener("click", () => {
        if (popover.style.display === "block") {
          popover.style.display = "none";
        } else {
          popover.style.display = "block";
        }
      });

      // Close the popover if clicked outside
      document.addEventListener("click", (event) => {
        if (!button.contains(event.target) && !popover.contains(event.target)) {
          popover.style.display = "none";
        }
      });
    </script>
  </body>
</html>
